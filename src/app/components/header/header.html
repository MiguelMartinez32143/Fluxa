<header class="app-header">
    <nav class="header-nav">
        <div class="header-container">

            <a routerLink="/" class="header-logo" aria-label="Fluxa Home">
                <svg class="header-logo-icon" width="30" height="30" viewBox="0 0 40 40" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="18" stroke="url(#logoGrad)" stroke-width="2.5" fill="none"
                        opacity="0.3" />
                    <path d="M10 20C10 20 13.5 13 17 13C20.5 13 19.5 27 23 27C26.5 27 30 20 30 20"
                        stroke="url(#logoGrad)" stroke-width="2.8" stroke-linecap="round" fill="none" />
                    <circle cx="20" cy="20" r="3" fill="url(#logoGrad)" opacity="0.9" />
                    <defs>
                        <linearGradient id="logoGrad" x1="8" y1="8" x2="32" y2="32">
                            <stop offset="0%" stop-color="#3B82F6" />
                            <stop offset="100%" stop-color="#818CF8" />
                        </linearGradient>
                    </defs>
                </svg>
                <span class="header-logo-text">Fluxa</span>
            </a>

            <ul class="header-links">
                <li><a routerLink="/inicio" class="header-link">Inicio</a></li>
                <li><a routerLink="/plans" class="header-link">Planes</a></li>
                <li><a routerLink="/contact" class="header-link">Contacto</a></li>
                <li><a routerLink="/about" class="header-link">Sobre Nosotros</a></li>
                <li><a routerLink="/licenses" class="header-link">Licencias</a></li>
            </ul>

            <div class="header-actions">
                <button class="header-link header-link-login" (click)="openModal('login')">Iniciar sesión</button>
                <button class="header-btn-primary" (click)="openModal('signup')">
                    Comenzar gratis
                    <span class="header-btn-dot"></span>
                </button>
            </div>

            <button class="header-mobile-toggle" aria-label="Abrir menú" (click)="toggleMenu()">
                <i class="bi" [ngClass]="isMenuOpen ? 'bi-x-lg' : 'bi-list'"></i>
            </button>

        </div>

        @if (isMenuOpen) {
        <div class="header-mobile-menu">
            <ul class="header-mobile-links">
                <li><a routerLink="/inicio" (click)="toggleMenu()">Inicio</a></li>
                <li><a routerLink="/licenses" (click)="toggleMenu()">Licencias</a></li>
                <li><a routerLink="/plans" (click)="toggleMenu()">Planes</a></li>
                <li><a routerLink="/contact" (click)="toggleMenu()">Contacto</a></li>
                <li><a routerLink="/about" (click)="toggleMenu()">Sobre Nosotros</a></li>
            </ul>
            <div class="header-mobile-actions">
                <button class="header-mobile-login" (click)="toggleMenu(); openModal('login')">Iniciar sesión</button>
                <button class="header-mobile-cta" (click)="toggleMenu(); openModal('signup')">
                    Comenzar gratis
                    <span class="header-btn-dot"></span>
                </button>
            </div>
        </div>
        }
    </nav>
</header>


<!-- ===== LOGIN MODAL ===== -->
@if (activeModal === 'login') {
<div class="modal-overlay" (click)="closeModal($event)">
    <div class="modal-card" (click)="$event.stopPropagation()">
        <button class="modal-close" (click)="dismissModal()">&times;</button>
        <h2 class="modal-title">Bienvenido de vuelta</h2>
        <form (submit)="$event.preventDefault(); handleLogin()">
            <div class="input-group-custom">
                <i class="bi bi-envelope"></i>
                <input type="email" placeholder="Correo electrónico" [(ngModel)]="loginEmail" name="loginEmail"
                    required />
            </div>
            <div class="input-group-custom">
                <i class="bi bi-lock"></i>
                <input [type]="showLoginPass ? 'text' : 'password'" placeholder="Contraseña" [(ngModel)]="loginPassword"
                    name="loginPassword" required />
                <button type="button" class="input-toggle" (click)="showLoginPass = !showLoginPass">
                    <i class="bi" [ngClass]="showLoginPass ? 'bi-eye-slash' : 'bi-eye'"></i>
                </button>
            </div>
            <div class="modal-extras">
                <label class="modal-checkbox"><input type="checkbox" /> Recordarme</label>
                <a (click)="switchModal('forgot')">¿Olvidaste contraseña?</a>
            </div>
            <button type="submit" class="btn-glow">Iniciar Sesión</button>
        </form>
        <div class="modal-divider"><span>O continúa con</span></div>
        <div class="modal-social">
            <button class="btn-social"><i class="bi bi-google"></i> Google</button>
            <button class="btn-social"><i class="bi bi-apple"></i> Apple</button>
        </div>
        <p class="modal-footer-text">
            ¿No tienes cuenta? <a (click)="switchModal('signup')">Regístrate</a>
        </p>
    </div>
</div>
}

<!-- ===== SIGNUP MODAL ===== -->
@if (activeModal === 'signup') {
<div class="modal-overlay" (click)="closeModal($event)">
    <div class="modal-card" (click)="$event.stopPropagation()">
        <button class="modal-close" (click)="dismissModal()">&times;</button>
        <h2 class="modal-title">Crea tu cuenta gratis</h2>
        <form (submit)="$event.preventDefault()">
            <div class="input-group-custom">
                <i class="bi bi-person"></i>
                <input type="text" placeholder="Nombre completo" [(ngModel)]="signupName" name="signupName" required />
            </div>
            <div class="input-group-custom">
                <i class="bi bi-envelope"></i>
                <input type="email" placeholder="Correo electrónico" [(ngModel)]="signupEmail" name="signupEmail"
                    required />
            </div>
            <div class="input-group-custom">
                <i class="bi bi-lock"></i>
                <input [type]="showSignupPass ? 'text' : 'password'" placeholder="Contraseña"
                    [(ngModel)]="signupPassword" name="signupPassword" required />
                <button type="button" class="input-toggle" (click)="showSignupPass = !showSignupPass">
                    <i class="bi" [ngClass]="showSignupPass ? 'bi-eye-slash' : 'bi-eye'"></i>
                </button>
            </div>
            @if (signupPassword) {
            <div class="password-strength">
                <div class="password-strength-bar">
                    <div class="password-strength-fill" [style.width]="passwordStrength + '%'"
                        [class.weak]="passwordStrength < 40"
                        [class.medium]="passwordStrength >= 40 && passwordStrength < 75"
                        [class.strong]="passwordStrength >= 75"></div>
                </div>
                <small class="password-strength-label">
                    {{ passwordStrength < 40 ? 'Débil' : passwordStrength < 75 ? 'Media' : 'Fuerte' }} </small>
            </div>
            }
            <div class="input-group-custom">
                <i class="bi bi-lock-fill"></i>
                <input [type]="showSignupPass ? 'text' : 'password'" placeholder="Confirmar contraseña"
                    [(ngModel)]="signupConfirm" name="signupConfirm" required />
            </div>
            @if (signupConfirm && signupPassword !== signupConfirm) {
            <small class="text-danger-small">Las contraseñas no coinciden</small>
            }
            <label class="modal-checkbox mb-3">
                <input type="checkbox" [(ngModel)]="acceptTerms" name="acceptTerms" />
                Acepto los <a href="#">términos y condiciones</a>
            </label>
            <button type="submit" class="btn-glow" [disabled]="!acceptTerms">Crear Cuenta Gratis</button>
        </form>
        <div class="modal-divider"><span>O continúa con</span></div>
        <div class="modal-social">
            <button class="btn-social"><i class="bi bi-google"></i> Google</button>
            <button class="btn-social"><i class="bi bi-apple"></i> Apple</button>
        </div>
        <p class="modal-footer-text">
            ¿Ya tienes cuenta? <a (click)="switchModal('login')">Inicia sesión</a>
        </p>
    </div>
</div>
}

<!-- ===== FORGOT PASSWORD MODAL ===== -->
@if (activeModal === 'forgot') {
<div class="modal-overlay" (click)="closeModal($event)">
    <div class="modal-card modal-card--sm" (click)="$event.stopPropagation()">
        <button class="modal-close" (click)="dismissModal()">&times;</button>
        <div class="text-center mb-3">
            <i class="bi bi-envelope-at-fill modal-big-icon"></i>
        </div>
        <h2 class="modal-title text-center">¿Olvidaste tu contraseña?</h2>
        <p class="modal-subtitle text-center">Te enviaremos instrucciones para restablecerla.</p>
        <form (submit)="$event.preventDefault()">
            <div class="input-group-custom">
                <i class="bi bi-envelope"></i>
                <input type="email" placeholder="Correo electrónico" [(ngModel)]="forgotEmail" name="forgotEmail"
                    required />
            </div>
            <button type="submit" class="btn-glow">Enviar Instrucciones</button>
        </form>
        <p class="modal-footer-text text-center mt-3">
            <a (click)="switchModal('login')"><i class="bi bi-arrow-left"></i> Volver a Iniciar Sesión</a>
        </p>
    </div>
</div>
}